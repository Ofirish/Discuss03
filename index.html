<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תרבות הדיון - משחק קלפים</title>
    <style>
        /* Existing CSS remains unchanged */
        /* New Progress Bar */
        #progressBar {
            position: absolute;
            top: 20px;
            width: 80%;
            max-width: 400px;
            height: 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            overflow: hidden;
        }
        #progressBar .progress {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.3s ease;
        }
        /* Language Switcher */
        #languageSwitcher {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }
        #languageSwitcher button {
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Language Switcher -->
    <div id="languageSwitcher">
        <button onclick="switchLanguage('he')">עברית</button>
        <button onclick="switchLanguage('en')">English</button>
    </div>

    <!-- Welcome Page -->
    <div id="welcomePage">
        <h1 id="welcomeTitle">ברוכים הבאים למשחק תרבות הדיון!</h1>
        <p id="welcomeText">
            תרבות הדיון חשובה מכיוון שהיא מאפשרת לנו להקשיב ולהבין את הדעות של אחרים בצורה מכבדת ובונה. דיונים מסודרים ומכובדים עוזרים לנו להגיע לפתרונות טובים יותר, לבנות שיתופי פעולה ולפתח חשיבה ביקורתית.
        </p>
        <button id="startGameButton">התחל משחק</button>
    </div>

    <!-- Game Container -->
    <div id="gameContainer">
        <div id="progressBar"><div class="progress"></div></div>
        <div class="hint">
            <span id="hintText">גרור ימינה עבור "כן" ושמאלה עבור "לא"</span>
        </div>
    </div>

    <!-- End Screen -->
    <div id="endScreen">
        <img id="resultImage" src="" alt="תוצאת המשחק">
        <h2>ניקוד סופי: <span id="finalScore">0</span></h2>
        <div id="shareButtons">
            <button id="restartButton">שחק שוב</button>
            <button id="shareWhatsApp">שתף בוואטסאפ</button>
            <button id="shareEmail">שלח במייל</button>
        </div>
    </div>

    <!-- Include Hammer.js -->
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
    <script>
        const translations = {
            he: {
                welcomeTitle: "ברוכים הבאים למשחק תרבות הדיון!",
                welcomeText: "תרבות הדיון חשובה מכיוון שהיא מאפשרת לנו להקשיב ולהבין את הדעות של אחרים בצורה מכבדת ובונה. דיונים מסודרים ומכובדים עוזרים לנו להגיע לפתרונות טובים יותר, לבנות שיתופי פעולה ולפתח חשיבה ביקורתית.",
                hintText: "גרור ימינה עבור 'כן' ושמאלה עבור 'לא'",
                finalScore: "ניקוד סופי",
                restartButton: "שחק שוב",
                shareWhatsApp: "שתף בוואטסאפ",
                shareEmail: "שלח במייל",
                resultExcellent: "הצלה מוצלחת!",
                resultGood: "הצלה טובה!",
                resultTryAgain: "להשתדל!",
            },
            en: {
                welcomeTitle: "Welcome to the Discussion Culture Game!",
                welcomeText: "Discussion culture is important because it allows us to listen and understand others' opinions respectfully. Well-organized discussions help us reach better solutions, build collaborations, and develop critical thinking.",
                hintText: "Swipe right for 'Yes' and left for 'No'",
                finalScore: "Final Score",
                restartButton: "Play Again",
                shareWhatsApp: "Share on WhatsApp",
                shareEmail: "Send via Email",
                resultExcellent: "Excellent!",
                resultGood: "Good!",
                resultTryAgain: "Try Again!",
            },
        };
        let currentLanguage = "he";

        function switchLanguage(lang) {
            currentLanguage = lang;
            document.getElementById("welcomeTitle").textContent = translations[lang].welcomeTitle;
            document.getElementById("welcomeText").textContent = translations[lang].welcomeText;
            document.getElementById("hintText").textContent = translations[lang].hintText;
            document.getElementById("finalScoreLabel").textContent = translations[lang].finalScore;
            document.getElementById("restartButton").textContent = translations[lang].restartButton;
            document.getElementById("shareWhatsApp").textContent = translations[lang].shareWhatsApp;
            document.getElementById("shareEmail").textContent = translations[lang].shareEmail;
        }

        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getRandomQuestions() {
            const shuffledQuestions = shuffleArray([...allQuestions]);
            return shuffledQuestions.slice(0, 10);
        }

        function createCard(question) {
            const card = document.createElement("div");
            card.classList.add("card");
            card.textContent = question;
            return card;
        }

        function updateProgressBar() {
            const progress = document.querySelector("#progressBar .progress");
            const progressPercentage = (currentQuestionIndex / currentQuestions.length) * 100;
            progress.style.width = `${progressPercentage}%`;
        }

        function showNextCard() {
            updateProgressBar();
            if (currentQuestionIndex >= currentQuestions.length) {
                endGame();
                return;
            }
            const question = currentQuestions[currentQuestionIndex].question;
            const card = createCard(question);
            document.getElementById("gameContainer").appendChild(card);

            const hammer = new Hammer(card);
            hammer.on("swipeleft", () => handleAnswer(card, "no"));
            hammer.on("swiperight", () => handleAnswer(card, "yes"));

            // Keyboard Navigation
            document.addEventListener("keydown", (e) => {
                if (e.key === "ArrowLeft") handleAnswer(card, "no");
                if (e.key === "ArrowRight") handleAnswer(card, "yes");
            });

            currentQuestionIndex++;
        }

        function handleAnswer(card, answer) {
            const correctAnswer = currentQuestions[currentQuestionIndex - 1].correctAnswer;
            if (answer === correctAnswer) {
                score += 10;
                showConfetti();
            } else {
                showThunder();
            }
            card.classList.add(answer === "yes" ? "glow-right" : "glow-left");
            setTimeout(() => flyAway(card, answer === "yes" ? "right" : "left"), 200);
        }

        function flyAway(card, direction) {
            card.style.transition = "transform 0.5s ease, opacity 0.5s ease";
            card.style.transform = `translate(${direction === "right" ? "100vw" : "-100vw"}, 0) rotate(${direction === "right" ? "30deg" : "-30deg"})`;
            card.style.opacity = "0";
            setTimeout(() => {
                card.remove();
                showNextCard();
            }, 500);
        }

        function showConfetti() {
            for (let i = 0; i < 20; i++) { // Reduced number of particles
                const confetti = document.createElement("div");
                confetti.classList.add("confetti");
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.animationDuration = `${Math.random() * 2 + 1}s`;
                confetti.style.backgroundColor = ["#ffcc00", "#ff6666", "#66ccff"][Math.floor(Math.random() * 3)];
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function showThunder() {
            const thunder = document.createElement("div");
            thunder.classList.add("thunder");
            document.body.appendChild(thunder);
            setTimeout(() => thunder.remove(), 500);
        }

        function endGame() {
            const endScreen = document.getElementById("endScreen");
            const finalScoreElement = document.getElementById("finalScore");
            const resultImage = document.getElementById("resultImage");
            finalScoreElement.textContent = score;

            if (score >= 90) {
                resultImage.src = `https://via.placeholder.com/200x200?text=${encodeURIComponent(translations[currentLanguage].resultExcellent)}`;
            } else if (score >= 50) {
                resultImage.src = `https://via.placeholder.com/200x200?text=${encodeURIComponent(translations[currentLanguage].resultGood)}`;
            } else {
                resultImage.src = `https://via.placeholder.com/200x200?text=${encodeURIComponent(translations[currentLanguage].resultTryAgain)}`;
            }
            endScreen.style.display = "flex";
        }

        function restartGame() {
            document.getElementById("endScreen").style.display = "none";
            document.getElementById("gameContainer").style.display = "block";
            currentQuestions = getRandomQuestions();
            currentQuestionIndex = 0;
            score = 0;
            showNextCard();
        }

        function shareResults(platform) {
            try {
                const scoreText = `I scored ${score} points in the Discussion Culture Game! 🎉`;
                const url = "https://via.placeholder.com/200x200?text=Excellent!";
                if (platform === "whatsapp") {
                    window.open(`https://wa.me/?text=${encodeURIComponent(scoreText)}%0A${url}`, "_blank");
                } else if (platform === "email") {
                    window.location.href = `mailto:?subject=Game Results&body=${encodeURIComponent(scoreText)}%0A${url}`;
                }
            } catch (error) {
                alert("An error occurred while sharing results. Please try again.");
            }
        }

        document.getElementById("startGameButton").addEventListener("click", () => {
            document.getElementById("welcomePage").style.display = "none";
            document.getElementById("gameContainer").style.display = "block";
            currentQuestions = getRandomQuestions();
            showNextCard();
        });

        document.getElementById("restartButton").addEventListener("click", restartGame);
        document.getElementById("shareWhatsApp").addEventListener("click", () => shareResults("whatsapp"));
        document.getElementById("shareEmail").addEventListener("click", () => shareResults("email"));
    </script>
</body>
</html>